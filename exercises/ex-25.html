<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Matthew Taliaferro">
<meta name="dcterms.date" content="2024-09-18">
<title>Alternative splicing – MOLB 7950</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
<meta property="og:title" content="Alternative splicing – MOLB 7950">
<meta property="og:description" content="Informatics and Statistics for Molecular Biology, Fall 2023.">
<meta property="og:site_name" content="MOLB 7950">
<meta name="twitter:title" content="Alternative splicing – MOLB 7950">
<meta name="twitter:description" content="Informatics and Statistics for Molecular Biology, Fall 2023.">
<meta name="twitter:image" content="https://rnabioco.github.io/molb-7950/exercises/images/twitter-card.png">
<meta name="twitter:creator" content="@rnabioco">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Alternative splicing</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../img/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/rnabioco/molb-7950" title="Course GitHub page" class="quarto-navigation-tool px-1" aria-label="Course GitHub page"><i class="bi bi-github"></i></a>
    <a href="https://sso.posit.cloud/cu-anschutz" title="Posit Cloud SSO login" class="quarto-navigation-tool px-1" aria-label="Posit Cloud SSO login"><i class="bi bi-cloud"></i></a>
    <a href="https://calendly.com/molb7950" title="Office hours scheduling" class="quarto-navigation-tool px-1" aria-label="Office hours scheduling"><i class="bi bi-calendar"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Course information</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-info/syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-info/support.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Support</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-info/team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Teaching team</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/bootcamp-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bootcamp resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/block-dna-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DNA Block resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resources/block-rna-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RNA Block resources</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-info/problem-sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problet Set Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-info/final-projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project Overview</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#split-alignments" id="toc-split-alignments" class="nav-link" data-scroll-target="#split-alignments">Split alignments</a></li>
  <li><a href="#split-alignments-1" id="toc-split-alignments-1" class="nav-link" data-scroll-target="#split-alignments-1">Split alignments</a></li>
  <li><a href="#strategy-in-action" id="toc-strategy-in-action" class="nav-link" data-scroll-target="#strategy-in-action">Strategy in action</a></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a></li>
  <li><a href="#how-star-works" id="toc-how-star-works" class="nav-link" data-scroll-target="#how-star-works">How STAR works</a></li>
  <li><a href="#how-star-works-1" id="toc-how-star-works-1" class="nav-link" data-scroll-target="#how-star-works-1">How STAR works</a></li>
  <li><a href="#how-star-works-2" id="toc-how-star-works-2" class="nav-link" data-scroll-target="#how-star-works-2">How STAR works</a></li>
  <li><a href="#how-star-works-3" id="toc-how-star-works-3" class="nav-link" data-scroll-target="#how-star-works-3">How STAR works</a></li>
  <li><a href="#running-star" id="toc-running-star" class="nav-link" data-scroll-target="#running-star">Running STAR</a></li>
  <li><a href="#annotation-files" id="toc-annotation-files" class="nav-link" data-scroll-target="#annotation-files">Annotation files</a></li>
  <li><a href="#annotation-files-1" id="toc-annotation-files-1" class="nav-link" data-scroll-target="#annotation-files-1">Annotation files</a></li>
  <li><a href="#make-star-index" id="toc-make-star-index" class="nav-link" data-scroll-target="#make-star-index">Make STAR index</a></li>
  <li><a href="#make-star-index-1" id="toc-make-star-index-1" class="nav-link" data-scroll-target="#make-star-index-1">Make STAR index</a></li>
  <li><a href="#star-align-reads" id="toc-star-align-reads" class="nav-link" data-scroll-target="#star-align-reads">STAR: align reads</a></li>
  <li><a href="#star-align-reads-1" id="toc-star-align-reads-1" class="nav-link" data-scroll-target="#star-align-reads-1">STAR: align reads</a></li>
  <li><a href="#mapping-stats-produced-by-star" id="toc-mapping-stats-produced-by-star" class="nav-link" data-scroll-target="#mapping-stats-produced-by-star">Mapping stats produced by STAR</a></li>
  <li><a href="#investigating-alignment-files" id="toc-investigating-alignment-files" class="nav-link" data-scroll-target="#investigating-alignment-files">Investigating alignment files</a></li>
  <li><a href="#alignments" id="toc-alignments" class="nav-link" data-scroll-target="#alignments">Alignments</a></li>
  <li><a href="#alignments-1" id="toc-alignments-1" class="nav-link" data-scroll-target="#alignments-1">Alignments</a></li>
  <li><a href="#alignments-2" id="toc-alignments-2" class="nav-link" data-scroll-target="#alignments-2">Alignments</a></li>
  <li><a href="#alignments-3" id="toc-alignments-3" class="nav-link" data-scroll-target="#alignments-3">Alignments</a></li>
  <li><a href="#alignments-4" id="toc-alignments-4" class="nav-link" data-scroll-target="#alignments-4">Alignments</a></li>
  <li><a href="#workflow-1" id="toc-workflow-1" class="nav-link" data-scroll-target="#workflow-1">Workflow</a></li>
  <li><a href="#psi-psi-values" id="toc-psi-psi-values" class="nav-link" data-scroll-target="#psi-psi-values">PSI (<span class="math inline">\(\psi\)</span>) values</a></li>
  <li><a href="#psi-psi-values-1" id="toc-psi-psi-values-1" class="nav-link" data-scroll-target="#psi-psi-values-1">PSI (<span class="math inline">\(\psi\)</span>) values</a></li>
  <li><a href="#types-of-alternative-splicing" id="toc-types-of-alternative-splicing" class="nav-link" data-scroll-target="#types-of-alternative-splicing">Types of alternative splicing</a></li>
  <li><a href="#running-rmats" id="toc-running-rmats" class="nav-link" data-scroll-target="#running-rmats">Running rMATS</a></li>
  <li><a href="#looking-at-rmats-output" id="toc-looking-at-rmats-output" class="nav-link" data-scroll-target="#looking-at-rmats-output">Looking at rMATS output</a></li>
  <li><a href="#rmats-output" id="toc-rmats-output" class="nav-link" data-scroll-target="#rmats-output">rMATS output</a></li>
  <li><a href="#rmats-output-1" id="toc-rmats-output-1" class="nav-link" data-scroll-target="#rmats-output-1">rMATS output</a></li>
  <li><a href="#rmats-output-2" id="toc-rmats-output-2" class="nav-link" data-scroll-target="#rmats-output-2">rMATS output</a></li>
  <li><a href="#rmats-output-3" id="toc-rmats-output-3" class="nav-link" data-scroll-target="#rmats-output-3">rMATS output</a></li>
  <li><a href="#rmats-output-4" id="toc-rmats-output-4" class="nav-link" data-scroll-target="#rmats-output-4">rMATS output</a></li>
  <li><a href="#rmats-output-5" id="toc-rmats-output-5" class="nav-link" data-scroll-target="#rmats-output-5">rMATS output</a></li>
  <li><a href="#tidy-rmats-output" id="toc-tidy-rmats-output" class="nav-link" data-scroll-target="#tidy-rmats-output">tidy rMATS output</a></li>
  <li><a href="#filter-rmats-output" id="toc-filter-rmats-output" class="nav-link" data-scroll-target="#filter-rmats-output">filter rMATS output</a></li>
  <li><a href="#plot-distribution-of-psi-values" id="toc-plot-distribution-of-psi-values" class="nav-link" data-scroll-target="#plot-distribution-of-psi-values">Plot distribution of PSI values</a></li>
  <li><a href="#pca-of-psi-values" id="toc-pca-of-psi-values" class="nav-link" data-scroll-target="#pca-of-psi-values">PCA of PSI values</a></li>
  <li><a href="#heatmap-of-psi-events" id="toc-heatmap-of-psi-events" class="nav-link" data-scroll-target="#heatmap-of-psi-events">heatmap of psi events</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/rnabioco/molb-7950/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/rnabioco/molb-7950/edit/main/exercises/ex-25.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Alternative splicing</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matthew Taliaferro </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 18, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="overview" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="overview">Overview</h2>
<p>In this lecture, we are going focus on analyzing the regulation of alternative splicing using RNAseq approaches.As we learned last week, <code>salmon</code> quantifies a fastq file of sequencing reads against a fasta file of all transcripts present in the sample. At the end of this analysis, we end up with quantifications for each transcript in our fasta file. However, for splicing you may be able to see how this strategy may need to be tweaked. <code>salmon</code> gave us transcript-level data, but for looking at splicing, we often want to measure how the inclusion of individual <strong>exons</strong> within transcripts differs between conditions. Thus, transcript-level quantifications are not directly useful here.</p>
<blockquote class="blockquote">
<p>Small aside: Actually, transcript level quantifications could work, because you could ask how the relative abundances of two different transcripts (one that has the exon in question and one that doesn’t) vary across conditions. See also <code>suppa2</code>.</p>
</blockquote>
</section><section id="split-alignments" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="split-alignments">Split alignments</h2>
<p>We need exon-level quantifications. So we want to count reads that either support the inclusion or exclusion of an exon.</p>
<p>Below are examples of some RNAseq reads mapped along a transcript. This transcript contains exons (yellow) and introns (gray). Let’s say that there are two isoforms of this gene: one where <code>exon2</code> is included and one where it is exlcuded. Reads have been “aligned” to this transcript to give a graphical representation of where they came from. You can see that the orange, purple, blue, and teal reads all <em>support</em> the inclusion of <code>exon2</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/block-rna/junc_read.png" class="img-fluid figure-img"></p>
<figcaption>Kim et al, Nat Methods, 2015</figcaption></figure>
</div>
</section><section id="split-alignments-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="split-alignments-1">Split alignments</h2>
<p>Another way to think about this is that the orange, purple, blue, and teal reads came from RNA molecules in which the transcript was included.</p>
<p>We know this because each of those reads cross a <strong>splice junction</strong> that is either <code>exon1-exon2</code> or <code>exon2-exon3</code>. These reads tell us, <strong>unambiguously</strong>, that <code>exon2</code> was included in the RNA molecule that these reads came from.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/block-rna/junc_read.png" class="img-fluid figure-img"></p>
<figcaption>Kim et al, Nat Methods, 2015</figcaption></figure>
</div>
<blockquote class="blockquote">
<p>What does the red read tell us? What would a read that unambiguously told us that exon2 was <em>excluded</em> look like?</p>
</blockquote>
</section><section id="strategy-in-action" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="strategy-in-action">Strategy in action</h2>
<p>Example of reads mapped to the area surrounding an alternative exon (the middle exon). The height of the red and blue area corresponds to the number of read coverage. The red and blue lines connecting exons represent the number of reads that span that junction. So for the blue condition, there are 347 reads (91 + 256) that support the inclusion of this exon, while 81 reads support its exclusion. In the red condition, this exon is less often excluded as 296 reads (65 + 231) support its inclusion while 130 support its exclusion. <em>Think about how often an exon was included in a sample as a ratio between the inclusion- and exclusion-supporting reads</em>.</p>
<p><img src="../img/block-rna/sashimi.png" class="img-fluid" style="width:50.0%"></p>
</section><section id="workflow" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="workflow">Workflow</h2>
<p>We will focus on the right side of the flowchart that relies on <a href="https://github.com/alexdobin/STAR"><code>STAR</code></a>, a splice-aware read aligner, and <a href="https://rnaseq-mats.sourceforge.io/"><code>rMATS</code></a>, an alternative splicing analysis tool.</p>
<p><img src="../img/block-rna/flowchart.png" class="img-fluid"></p>
</section><section id="how-star-works" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="how-star-works">How STAR works</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>STAR begins by finding matches (either unique or nonunique) between a portion of a read and the reference. This matching region of the query is extended along the reference until the two start to disagree. If this match extends all the way through to the end of the read, then the read lies completely within one exon (or intron, or I guess intergenic region if you are bad at making RNAseq libraries) and we are done. If the match ends before the end of the read, the part that has matched so far defines one <em>seed</em>.</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/seed1.png" class="img-fluid"></p>
</div>
</div>
</section><section id="how-star-works-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="how-star-works-1">How STAR works</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>STAR then takes the rest of the query and uses it to find the best match to its sequence in the reference, defining another seed.</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/seed2.png" class="img-fluid"></p>
</div>
</div>
</section><section id="how-star-works-2" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="how-star-works-2">How STAR works</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>If, during the extension of a match a small region of mismatch or discontinuity occurs, these can be identified as mutations or indels if high-quality matches between the query and reference resume later in the read.</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/indel.png" style="width:50.0%;height:100.0%"></p>
</div>
</div>
</section><section id="how-star-works-3" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="how-star-works-3">How STAR works</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>After aligning seeds, they can be stitched together. The stitching of seeds with high alignment quality (low number of indels, mismatches) is prefered over the stitching of seeds with low alignment quality (high number of indels, mismatches).</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/stitch.png" class="img-fluid"></p>
</div>
</div>
</section><section id="running-star" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="running-star">Running STAR</h2>
<p>To align reads, we first need to create an <strong>index</strong> of the genome (see STAR manual <a href="https://physiology.med.cornell.edu/faculty/skrabanek/lab/angsd/lecture_notes/STARmanual.pdf">here</a>. To do this, <code>STAR</code> will require the sequence of the genome (in fasta format), and an annotation that tells it where exons and introns are. It needs the annotation to be able to see if seeds that it stitches together make sense with what we know about exon/intron structures that exist in the transcriptome. Let’s take a look at one of these genome annotation files.</p>
</section><section id="annotation-files" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="annotation-files">Annotation files</h2>
<p>The most common annotation files are <code>GTF</code> and <code>GFF</code> files. Here’s an example of a <code>GFF</code>.</p>
<p><img src="../img/block-rna/gff.png" class="img-fluid"></p>
<p>Each line corresponds to one feature. This is a tab-delimited text file. There are only a few columns that we care about:</p>
<ul>
<li>Column 1: chromosome</li>
<li>Column 2: source</li>
<li>Column 3: feature type</li>
<li>Column 4: feature start</li>
<li>Column 5: feature end</li>
<li>Column 7: strand (you aren’t in DNA land anymore…strand matters)</li>
</ul></section><section id="annotation-files-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="annotation-files-1">Annotation files</h2>
<p><img src="../img/block-rna/gff.png" class="img-fluid"></p>
<p>Column 8 contains various information about the feature. Perhaps the most important one tells you about the hierarchy that defines the relationship between features. For example, genes contain <em>children</em> transcripts within them, and each transcript contains <em>children</em> exons. Transcripts will therefore belong to <em>parent</em> genes and exons will belong to <em>parent</em> transcripts. Biologically, this should make sense to you. These relationships are indicated by the <strong>Parent</strong> attribute within column 8.</p>
</section><section id="make-star-index" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="make-star-index">Make STAR index</h2>
<p>OK now we are ready to make our index. There relevant options we will need to pay attention to when doing this are shown below:</p>
<ul>
<li>
<strong>–runMode</strong> genomeGenerate (we are making an index, not aligning reads)</li>
<li>
<strong>–genomeDir</strong> /path/to/genomeDir (where you want STAR to put this index we are making)</li>
<li>
<strong>–genomeFastaFiles</strong> /path/to/genomesequence (genome sequence as fasta, either one file or multiple)</li>
<li>
<strong>–sjdbGTFfile</strong> /path/to/annotations.gff (yes it says gtf, but we are going to use a gff format)</li>
<li>
<strong>–sjdbOverhang</strong> 100 (100 will usually be a good value here, the recommended value is readLength - 1)</li>
<li>
<strong>–sjdbGTFtagExonParentTranscript</strong> Parent (we have to specify this because we are using a gff annotation and this is how gff files denote relationships)</li>
<li>
<strong>–genomeSAindexNbases</strong> 11 (don’t worry about this one, we are specifying it because we are using an artificially small genome in this example)</li>
</ul></section><section id="make-star-index-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="make-star-index-1">Make STAR index</h2>
<blockquote class="blockquote">
<p>STAR –runMode genomeGenerate –genomeDir {path-to}/mySTARindex –genomeFastaFiles {path-to}/genome.fasta –sjdbGTFfile {path-to}/MOLB7950.gff3 –sjdbOverhang 100 –sjdbGTFtagExonParentTranscript Parent –genomeSAindexNbases 11</p>
</blockquote>
<p><img src="../img/block-rna/star_index_out.png" class="img-fluid"></p>
</section><section id="star-align-reads" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="star-align-reads">STAR: align reads</h2>
<p>Now that we have our index we are ready to align our reads. The options we need to pay attention to here are:</p>
<ul>
<li>
<strong>–runMode</strong> alignReads (we are aligning this time)</li>
<li>
<strong>–genomeDir</strong> /path/to/genomeDir (a path to the index we made in the previous step)</li>
<li>
<strong>–readFilesIn</strong> /path/to/forwardreads /path/to/reversereads (paths to our fastqs, separated by a space)</li>
<li>
<strong>–readFilesCommand</strong> gunzip -c (our reads our gzipped so we need to tell STAR how to read them)</li>
<li>
<strong>–outFileNamePrefix</strong> path/to/outputdir (where to put the results)</li>
<li>
<strong>–outSAMtype</strong> BAM SortedByCoordinate (the format of the alignment output, more on this later)</li>
</ul>
<p>Now we are ready to align our reads.</p>
</section><section id="star-align-reads-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="star-align-reads-1">STAR: align reads</h2>
<blockquote class="blockquote">
<p>STAR –runMode alignReads –genomeDir {path-to}/mySTARindex/ –readFilesIn {path-to}/MOLB7950_1.fastq.gz {path-to}/MOLB7950_2.fastq.gz –readFilesCommand gunzip -c –outFileNamePrefix {path-to}/myalignments –outSAMtype BAM SortedByCoordinate</p>
</blockquote>
<p><img src="../img/block-rna/read_align_status.png" class="img-fluid"></p>
</section><section id="mapping-stats-produced-by-star" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="mapping-stats-produced-by-star">Mapping stats produced by STAR</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Well so how did it go? Check the log file. We can see that we put in almost 100k read pairs and 96.7k of these could be uniquely assigned to a single genomic position. 95.6k of these had a splice junction. This is expected for paired end reads against a genome with many introns and short exons.</p>
<p>As an aside, any read that aligns more times than is allowed by the flag <strong>–outFilterMultimapNmax</strong> is not reported in the alignments. As a default, this value is set to 10. Libraries that are made from low complexity RNA samples and those that deal with repetitive genomic regions can be sensitive to this. Also, if you wanted to, you can use this flag to restrict your alignment file to those that only <em>uniquely</em> aligned by setting this value to 1.</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/star_out.png" class="img-fluid"></p>
</div>
</div>
</section><section id="investigating-alignment-files" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="investigating-alignment-files">Investigating alignment files</h2>
<p>Our alignment output file is <code>dummyAligned.sortedByCoord.out.bam</code>. <code>BAM</code> files are binary files and need to be converted to plain text using <code>samtools view</code> for us to read it.</p>
<blockquote class="blockquote">
<p>samtools view dummyAligned.sortedByCoord.out.bam &gt; dummyAligned.sam</p>
</blockquote>
</section><section id="alignments" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="alignments">Alignments</h2>
<p>SAM files can be a little confusing, but it’s worth taking the time to get to know them. The full SAM format specification can be found <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">here</a>.</p>
<p>Let’s take a look at our SAM file and see what we see. I’m going to pick 2 lines out.</p>
<p><img src="../img/block-rna/sam_example.png" class="img-fluid"></p>
<p>Here we are looking at 2 lines from this file. These two lines correspond to two paired reads. I know that because the first field in this file is the read ID as it came off the sequencer. You can see that these two reads have the same ID (it’s the thing I grepped for).</p>
</section><section id="alignments-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="alignments-1">Alignments</h2>
<p><img src="../img/block-rna/sam_example.png" class="img-fluid"></p>
<p>The <strong>second</strong> field is a bitwise flag. It is a sum of integers where each integer tells us something about the read. Every possible value of this flag is a unique combination of the informative integers. You can see what each of these integers are and what they mean in the <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">SAM format specification</a>. There is also a handy calculator that you can plug your value into and it will tell you what your flag means <a href="https://www.samformat.info/sam-format-flag">here</a>. If we put our first flag, 163, in there it tell us that this read is:</p>
<ul>
<li>The second read in a mate pair (128)</li>
<li>On the opposite strand of its mate pair (32)</li>
<li>Is mapped and properly paired (2)</li>
<li>Is paired (1)</li>
</ul>
<p>If you put the flag value for the second read into the calculator, what do you get?</p>
</section><section id="alignments-2" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="alignments-2">Alignments</h2>
<p><img src="../img/block-rna/sam_example.png" class="img-fluid"></p>
<p>The <strong>third</strong> field is obviously the reference name. No big mystery there. This read maps to chromosome 19.</p>
<p>The <strong>fourth</strong> field is the position on the reference that corresponds to the beginning of the query. This read starts to map to chr19 beginning at position 3371611. As a aside, positions reported in SAM files are 1-based, not 0-based.</p>
</section><section id="alignments-3" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="alignments-3">Alignments</h2>
<p><img src="../img/block-rna/sam_example.png" class="img-fluid"></p>
<p>The <strong>sixth</strong> field is called the CIGAR string. This is a string of characters that tells you a little bit about <em>how</em> the query aligns to the reference. Again, details can be found in the <a href="https://samtools.github.io/hts-specs/SAMv1.pdf">SAM format specification</a>. The CIGAR string for the first read can be interpreted as follows:</p>
<ul>
<li>The first 67 bases in the query align to the reference.</li>
<li>There is then a gap in the reference of 3415 nt.</li>
<li>Then the query starts to match again, and does so for the next 84 nt.</li>
</ul>
<p>These are paired end 151 nt reads, so it makes sense that 67 + 84 = 151.</p>
<p>In not so shocking news, the top read’s mate (the second read) also has a gap in the reference of 3415 nt. As you might have guessed, these reads are spanning the same intron, which you would expect reads from the same mate pair to do.</p>
</section><section id="alignments-4" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="alignments-4">Alignments</h2>
<p>The <strong>ninth</strong> field is the <em>template length</em>, abbreviated TLEN. This is the distance, in nt, from the beginning of one read in a pair to the end of it’s mate.</p>
<p><img src="../img/block-rna/tlen.png" class="img-fluid"></p>
<p>If you know a little bit about how RNAseq libraries are made, you might know that transcripts are fragmented, usually to lengths of 200-500 nt. Given that this read is stretching over 3 kb along the reference sequence, it’s a good bet that it is spanning an intron that is present in the reference but had been removed in the RNA molecule i.e.&nbsp;it was spliced out!</p>
</section><section id="workflow-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="workflow-1">Workflow</h2>
<p>Now that we have aligned with <code>STAR</code>, we can calculate exon inclusion with <code>rMATS</code>. As is often the case with bioinformatic tools, <code>rMATS</code> is not the only tool that you can use to look at alternative splicing, but it has been around for a while and has been thoroughly tested.</p>
<p><img src="../img/block-rna/flowchart.png" class="img-fluid"></p>
</section><section id="psi-psi-values" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="psi-psi-values">PSI (<span class="math inline">\(\psi\)</span>) values</h2>
<p>In many scenarios, splicing is quantified using a metric called PSI (Percent Spliced In), often shown as the greek letter <span class="math inline">\(\psi\)</span>, is a metric that asks what fraction of transcripts <em>contain</em> the exon or RNA sequence in question. Thus, <span class="math inline">\(\psi\)</span> values range from 0 (which would indicate that the exon is never included) to 1 (which would indicate that the exon is always included). <span class="math inline">\(\psi\)</span> can be estimated by counting the number of reads that unambiguously support the inclusion of the exon and the number of reads that unambiguously support exclusion of the exon.</p>
<p>For skipped “cassette” exons, these reads are diagrammed below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/block-rna/sepsi.jpg" class="img-fluid figure-img"></p>
<figcaption>Shen et al, (2014). PNAS</figcaption></figure>
</div>
</section><section id="psi-psi-values-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="psi-psi-values-1">PSI (<span class="math inline">\(\psi\)</span>) values</h2>
<p>In this diagram, the exon in gray can either be included or skipped to produced two different transcript isoforms. Reads in red (I for inclusion) unambiguously argue for the inclusion of the exon while reads in green (S for skipping) unambiguously argue for skipping of the exon. Keep in mind that the reads drawn over splice junctions indicate the the read spans the splice junction.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/block-rna/sepsi.jpg" class="img-fluid figure-img"></p>
<figcaption>Shen et al, (2014). PNAS</figcaption></figure>
</div>
<blockquote class="blockquote">
<p>Note: Red reads that do not cross a junction but lie totally within the gray exon are often used in splicing analysis, but do not formally unambiguously show exon inclusion. It is safer to rely <strong>only</strong> on splice-junction spanning reads for splicing quantitation. The downside of this is that you will lose read counts that came from non-junction reads. Fewer read counts means less statistical power.</p>
</blockquote>
</section><section id="types-of-alternative-splicing" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="types-of-alternative-splicing">Types of alternative splicing</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../img/block-rna/astypes_1.png" class="img-fluid figure-img"></p>
<figcaption>Shen et al, (2014). PNAS</figcaption></figure>
</div>
</div><div class="column" style="width:50%;">
<p>There are other types of alternative splicing besides skipped exons. In each case, <span class="math inline">\(\psi\)</span> is defined as the fraction of transcript in which the white sequence is included.</p>
<p>Since we have already determined where in the genome RNAseq reads came from using <code>STAR</code>, we will now use <code>rMATS</code> to take those locations and combine it with information about the locations of alternative exons to quantify the inclusion of each alternative exon.</p>
</div>
</div>
</section><section id="running-rmats" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="running-rmats">Running rMATS</h2>
<p>To quantify alternative splicing, <code>rMATS</code> needs two things: the locations of the reads in the genome (bam files) and the locations of alternative exons in the genome (GTF annotation file).</p>
<blockquote class="blockquote">
<p>Note: You may remember that when we ran STAR, we used a different type of genome annotaiton file: GFF. GTFs and GFFs contain essentially the same information and it is possible to interconvert between the two. I chose to introduce you to GFFs because, to my mind, they are more intuitive to and readable by humans. STAR could handle both GTF and GFF formats. rMATS requires GTFs.</p>
</blockquote>
<p>Here are the most relevant options when running <code>rMATS</code>. See the documentation <a href="https://github.com/Xinglab/rmats-turbo/blob/v4.1.0/README.md">here</a>.</p>
<ul>
<li>
<strong>–b1</strong> /path/to/b1.txt (path to a text file that contains paths to all BAM files for samples in condition 1)</li>
<li>
<strong>–b2</strong> /path/to/b2.txt (path to a text file that contains paths to all BAM files for samples in condition 2)</li>
<li>
<strong>–gtf</strong> /path/to/gtf (path to the gtf genome annotation)</li>
<li>
<strong>-t</strong> readtype (single or paired)</li>
<li>
<strong>–readlength</strong> readlength</li>
<li>
<strong>–od</strong> /path/to/output (output directory)</li>
</ul></section><section id="looking-at-rmats-output" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="looking-at-rmats-output">Looking at rMATS output</h2>
<p>In this example, the authors were interested in the splicing regulatory activity of the RNA-binding protein RBFOX2. They sequenced RNA from cells that had been treated with either shRNA against RBFOX2 or a control, non-targeting shRNA. Each condition was performed in quadruplicate, meaning we have 4 replicates for each condition. I downloaded their data, aligned it against the mouse genome using <code>STAR</code>, and then quantified alternative splicing using <code>rMATS</code>.</p>
<p>We won’t run <code>rMATS</code> here because we would need multiple large bam files to do anything meaningful, and honestly, it’s just copying things from the documentation and putting them into the command line. What we will do though, is look at the output produced by <code>rMATS</code>.</p>
</section><section id="rmats-output" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output">rMATS output</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>You can see that there are many files here, and that each type of alternative splicing (A3SS, A5SS, MXE, RI, and SE) has files associated with it. Specifically each event type has 2 files: one that ends in ‘JC.txt’ and one that ends in ‘JCEC.txt’. The ‘JC.txt’ files only use reads that cross splice junctions to quantify splicing (JC = junction counts) while the ‘JCEC.txt’ files use both junction reads <em>and</em> reads that map to the alternative exon (EC = exon counts). We are going to use the files ending in <code>*JC.txt</code>.</p>
</div><div class="column" style="width:50%;">
<p><img src="../img/block-rna/rmats_dir.png" class="img-fluid"></p>
</div>
</div>
</section><section id="rmats-output-1" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output-1">rMATS output</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>If we look at <code>SE.MATS.JC.txt</code> file the column names are at the top. Let’s go through some of the more important columns:</p>
<ul>
<li>
<strong>ID</strong> A unique identifier for this event.</li>
<li>
<strong>chr</strong> chromosome</li>
<li>
<strong>strand</strong> strand (+ or -)</li>
<li>
<strong>exonStart_0base</strong> the coordinate of the beginning of the alternative exon (using 0-based coordinates)</li>
<li>
<strong>exonEnd</strong> the coordinate of the end of the alternative exon</li>
</ul>
</div><div class="column" style="width:60%;">
<p><img src="../img/block-rna/rmats_out.png" class="img-fluid"></p>
</div>
</div>
</section><section id="rmats-output-2" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output-2">rMATS output</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>
<strong>upstreamES</strong> the coordinate of the beginning of the exon immediately upstream of the alternative exon</li>
<li>
<strong>upstreamEE</strong> the coordinate of the end of the exon immediately upstream of the alternative exon</li>
<li>
<strong>downstreamES</strong> the coordinate of the beginning of the exon immediately downstream of the alternative exon</li>
<li>
<strong>downstreamEE</strong> the coordinate of the end of the exon immediately downstream of the alternative exon</li>
</ul>
</div><div class="column" style="width:60%;">
<p><img src="../img/block-rna/rmats_out.png" class="img-fluid"></p>
</div>
</div>
</section><section id="rmats-output-3" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output-3">rMATS output</h2>
<p>Notice that with these coordinates and the sequence of the genome, you could derive the sequences flanking each of these exons. That could be useful, perhaps, if you wanted to ask if there were short sequences (kmers) enriched near exons whose inclusion was sensitive to RBFOX2 loss versus exons whose inclusion was insensitive.</p>
<ul>
<li>
<strong>IJC_SAMPLE_X</strong> the number of read counts that support inclusion of the exon is sample X (four numbers, one for each replicate, each separated by a comma)</li>
<li>
<strong>SJC_SAMPLE_X</strong> same thing, but for read counts that support the exclusion of the exon</li>
</ul></section><section id="rmats-output-4" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output-4">rMATS output</h2>
<p>The numbers from <code>[S|I]JC_SAMPLE_X</code> could be useful for filtering events based on coverage. Say, for example, that we were looking at an event that when we combined IJC and SJC counts for each replicate we got something like 2,4,1,5. That would mean that in the replicates for this condition, we only had 2, 4, 1, and 5 reads that tell us anything about the status of this exon. That’s pretty low, so I would argue that we really wouldn’t want to consider this event at all since we don’t have much confidence that we know anything about its inclusion.</p>
<ul>
<li>
<strong>PValue</strong> The pvalue asking if the PSI values for this event between the two conditions is statistically significantly different</li>
<li>
<strong>FDR</strong> The p value, after it has been corrected for multiple hypothesis testing. This is the significance value you would want to filter on.</li>
<li>
<strong>IncLevel1</strong> PSI values for the replicates in condition 1 (in this case, condition 1 is RBFOX shRNA).</li>
<li>
<strong>IncLevel2</strong> PSI values for the replicates in condition 2 (in this case, condition 2 is Control shRNA).</li>
<li>
<strong>IncLevelDifference</strong> Difference in PSI values between conditions (Condition 1 - Condition 2).</li>
</ul></section><section id="rmats-output-5" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="rmats-output-5">rMATS output</h2>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">psis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data/block-rna/rMATS/SE.MATS.JC.txt.gz"</span><span class="op">)</span>, header <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#Get rid of columns we aren't really going to use.</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ID'</span>, <span class="st">'geneSymbol'</span>, <span class="st">'IJC_SAMPLE_1'</span>, <span class="st">'SJC_SAMPLE_1'</span>, <span class="st">'IJC_SAMPLE_2'</span>, <span class="st">'SJC_SAMPLE_2'</span>, <span class="st">'FDR'</span>, <span class="st">'IncLevel1'</span>, <span class="st">'IncLevel2'</span>, <span class="st">'IncLevelDifference'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">psis</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will only consider events where there are <em>at least</em> 20 informative reads that tell us about the inclusion of the exon <code>IJC + SJC &gt; 20</code> in <strong>every replicate</strong>. For example, for event ‘5’ (gene Neil1) above, Sample 1 replicates have 12, 6, 9, and 5 reads while Sample 2 replicates have 10, 8, 14, and 0 reads. I would want to require that all of 12, 6, 9, 5, 10, 8, 14, and 0 are greater than 20 in order to worry about this event. Otherwise, I conclude that we don’t have enough data to accurately conclude anything about this event.</p>
</section><section id="tidy-rmats-output" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="tidy-rmats-output">tidy rMATS output</h2>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">psis</span> <span class="op">&lt;-</span> <span class="va">psis</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co">#Split the replicate read counts that are separated by commas into different columns</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">.</span>, col <span class="op">=</span> <span class="va">IJC_SAMPLE_1</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'IJC_S1R1'</span>, <span class="st">'IJC_S1R2'</span>, <span class="st">'IJC_S1R3'</span>, <span class="st">'IJC_S1R4'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">','</span>, remove <span class="op">=</span> <span class="cn">T</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">.</span>, col <span class="op">=</span> <span class="va">SJC_SAMPLE_1</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'SJC_S1R1'</span>, <span class="st">'SJC_S1R2'</span>, <span class="st">'SJC_S1R3'</span>, <span class="st">'SJC_S1R4'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">','</span>, remove <span class="op">=</span> <span class="cn">T</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">.</span>, col <span class="op">=</span> <span class="va">IJC_SAMPLE_2</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'IJC_S2R1'</span>, <span class="st">'IJC_S2R2'</span>, <span class="st">'IJC_S2R3'</span>, <span class="st">'IJC_S2R4'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">','</span>, remove <span class="op">=</span> <span class="cn">T</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">separate</span><span class="op">(</span><span class="va">.</span>, col <span class="op">=</span> <span class="va">SJC_SAMPLE_2</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'SJC_S2R1'</span>, <span class="st">'SJC_S2R2'</span>, <span class="st">'SJC_S2R3'</span>, <span class="st">'SJC_S2R4'</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">','</span>, remove <span class="op">=</span> <span class="cn">T</span>, convert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">psis</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="filter-rmats-output" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="filter-rmats-output">filter rMATS output</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">&lt;-</span> ??</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>psis_filt <span class="ot">&lt;-</span> psis <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S1R1counts =</span> ?? <span class="sc">+</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S1R2counts =</span> ?? <span class="sc">+</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S1R3counts =</span> IJC_S1R3 <span class="sc">+</span> SJC_S1R3) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S1R4counts =</span> IJC_S1R4 <span class="sc">+</span> SJC_S1R4) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S2R1counts =</span> ?? <span class="sc">+</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S2R2counts =</span> ?? <span class="sc">+</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S2R3counts =</span> IJC_S2R3 <span class="sc">+</span> SJC_S2R3) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">S2R4counts =</span> IJC_S2R4 <span class="sc">+</span> SJC_S2R4) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Filter on read counts</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(., S1R1counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S1R2counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S1R3counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S1R4counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>           S2R1counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S2R2counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S2R3counts <span class="sc">&gt;=</span> thresh <span class="sc">&amp;</span> S2R4counts <span class="sc">&gt;=</span> thresh)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(psis_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="plot-distribution-of-psi-values" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="plot-distribution-of-psi-values">Plot distribution of PSI values</h2>
<p>Exons whose inclusion is not regulated tend to have PSI values that are either very close to 0 or very close to 1 (i.e.&nbsp;these exons are pretty much always included or always skipped). Exons whose inclusion is regulated tend to have PSI values that are more evenly spread between 0 and 1. Do see this in our data?</p>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>psis_filt_psi <span class="ot">&lt;-</span> psis_filt <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Separate psi value replicates into individual columns</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., <span class="at">col =</span> ??, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'PSI_S1R1'</span>, <span class="st">'PSI_S1R2'</span>, <span class="st">'PSI_S1R3'</span>, <span class="st">'PSI_S1R4'</span>), <span class="at">sep =</span> <span class="st">','</span>, <span class="at">remove =</span> T, <span class="at">convert =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(., <span class="at">col =</span> ??, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'PSI_S2R1'</span>, <span class="st">'PSI_S2R2'</span>, <span class="st">'PSI_S2R3'</span>, <span class="st">'PSI_S2R4'</span>), <span class="at">sep =</span> <span class="st">','</span>, <span class="at">remove =</span> T, <span class="at">convert =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Select the columns we want</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(., <span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">'PSI'</span>), FDR))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Turn data from wide format into long format for plotting purposes</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>psis_filt_psi_long <span class="ot">&lt;-</span> <span class="fu">gather</span>(psis_filt_psi,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">key =</span> sample,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">value =</span> psi,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                             PSI_S1R1<span class="sc">:</span>PSI_S2R4) <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#For each row, mark whether that replicate came from Condition 1 (RBFOXkd) or Condition2 (Controlkd)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#We can tell that by asking if the substring 'S1' is somewhere in 'sample'</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">condition =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'S1'</span>, sample), <span class="st">'RBFOX2kd'</span>, <span class="st">'Controlkd'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make a column indicating whether the FDR in this row is significant</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">sig =</span> <span class="fu">ifelse</span>(FDR <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">'yes'</span>, <span class="st">'no'</span>))</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'DarkOrange'</span>, <span class="st">'DarkViolet'</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psis_filt_psi_long,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> ??, <span class="at">linetype =</span> ??, <span class="at">color =</span> sig)) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sig, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="pca-of-psi-values" class="level2 smaller"><h2 class="smaller anchored" data-anchor-id="pca-of-psi-values">PCA of PSI values</h2>
<p>Just as we did with gene expression values, we can monitor the quality of this data using principle components analysis. We would expect that replicates within a condition would be clustered next to each other in this analysis and that PC1, the principal component along which the majority of the variance lies, would separate the conditions.</p>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make a matrix of psi values</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>psis.matrix <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(psis_filt_psi, <span class="sc">-</span>??) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>(.)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Use prcomp() to derive principle component coordinants of PSI values</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>psi.pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(<span class="fu">t</span>(psis.matrix))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Add annotations of the conditions to the samples</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>psi.pca.pc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(psi.pca<span class="sc">$</span>x, <span class="at">sample =</span> <span class="fu">colnames</span>(psis.matrix)) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">condition =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">'S1'</span>, sample), <span class="st">'RBFOX2kd'</span>, <span class="st">'Controlkd'</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the amount of variances contained within PC1 and PC2</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>psi.pca.summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(psi.pca)<span class="sc">$</span>importance</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>pc1var <span class="ot">=</span> <span class="fu">round</span>(psi.pca.summary[<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>pc2var <span class="ot">=</span> <span class="fu">round</span>(psi.pca.summary[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot PCA data</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psi.pca.pc, <span class="fu">aes</span>(<span class="at">x =</span> ??, <span class="at">y =</span> ??, <span class="at">shape =</span> ??, <span class="at">color =</span> ??)) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>)  <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">paste</span>(<span class="st">'PC1,'</span>, pc1var, <span class="st">'% explained var.'</span>)) <span class="sc">+</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">paste</span>(<span class="st">'PC2,'</span>, pc2var, <span class="st">'% explained var.'</span>)) <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="heatmap-of-psi-events" class="level2"><h2 class="anchored" data-anchor-id="heatmap-of-psi-events">heatmap of psi events</h2>
<div class="cell" data-output-location="slide">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter only significant events</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>psi_sig <span class="ot">&lt;-</span> psis_filt_psi <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(?? <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>??)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># row scaled heatmap</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(<span class="at">mat =</span> psi_sig,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">clustering_method =</span> <span class="st">"ward.D2"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">scale =</span> <span class="st">"??"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_rownames =</span> F</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>          )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/rnabioco\.github\.io\/molb-7950\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rnabioco/molb-7950/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/rnabioco/molb-7950/edit/main/exercises/ex-25.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>