{
  "hash": "ba75c448f1590d679f7ec8ffff751f68",
  "result": {
    "markdown": "---\ntitle: \"Stats Bootcamp - class 12\"\nsubtitle: \"Hypothesis testing\"\nauthor: \"Neelanjan Mukherjee\"\neditor: visual\n---\n\n\n\n\n## Two changes {.smaller}\n\n1.  We are going to use `ggpubr` rather than `ggplot2` - Don't tell Jay ;)\n\n-   It has great visualization for the stats on the plots.\n-   Different syntax!!\n    -   **must use double quotes around \"variable names\"**\n\n2.  Due to reviewer #3, we will pivot to a more \"physiologically relevant\" data set `biochem` that consists of mouse measurements.\n\n. . .\n\n## Prepare mouse biochem data {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# we are reading the data directly from the internet\nbiochem <- read_tsv(\"http://mtweb.cs.ucl.ac.uk/HSMICE/PHENOTYPES/Biochemistry.txt\", show_col_types = FALSE) |>\n  janitor::clean_names()\n\n# simplify names a bit more\ncolnames(biochem) <- gsub(pattern = \"biochem_\", replacement = \"\", colnames(biochem))\n\n# we are going to simplify this a bit and only keep some columns\nkeep <- colnames(biochem)[c(1,6,9,14,15,24:28)]\nbiochem <- biochem[,keep]\n\n# get weights for each individual mouse\n# careful: did not come with column names\nweight <- read_tsv(\"http://mtweb.cs.ucl.ac.uk/HSMICE/PHENOTYPES/weight\", col_names = F, show_col_types = FALSE)\n\n# add column names\ncolnames(weight) <- c(\"subject_name\",\"weight\")\n\n# add weight to biochem table and get rid of NAs\n# rename gender to sex\nb <- inner_join(biochem, weight, by=\"subject_name\") |> \n  na.omit() |>\n  rename(sex=gender)\n```\n:::\n\n\n## Compare mean of a variable to a known value {.smaller}\n\n$y$ is independent of $x$\n\n$y$ is continuous\n\n$x$ is constant\n\n**Parametric: One-sample t-test**\n\n`t_test(y ~ 1, mu = x)`\n\n**Nonparametric: Wilcoxon signed-rank**\n\n`wilcox_test(y ~ 1, mu = x)`\n\n1.  Examine and specify the variable(s)\n2.  Declare null hypothesis $\\mathcal{H}_0$\n3.  Calculate test-statistic, exact p-value\n\nThink did the expression of my gene change...\n\n## 1. Examine and specify the variable(s) {.smaller}\n\nLet's explore mouse $weight$\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggdensity(\n  data = b,\n  x = \"??\",\n  add = \"mean\",\n  rug = TRUE\n  )\n```\n:::\n\n\n. . .\n\nlet's see some summary stats\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |> \n  get_summary_stats(\n    ??,\n    type = \"common\",\n    show = c(\"mean\",\"median\",\"sd\")\n    )\n```\n:::\n\n\n## Is it normally distributed?\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggqqplot(\n  data = b,\n  x = \"??\"\n  )\n```\n:::\n\n\nLooks reasonable\n\n. . .\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |> \n  ??_test(weight)\n```\n:::\n\n\nYikes!\n\nNo easy answers...gotta make a call. We'll try both.\n\n## 2. Declare null hypothesis $\\mathcal{H}_0$\n\nSince this is a one-way test, we don't need to worry if the groups have equal variance (only 1 group). But, we need a standard to compare against. I asked google, `how much does a mouse weigh in grams?`\n\nAnswer: 20-35 g, I'm going with $27.5 g$ as our standard.\n\n> $\\mathcal{H}_0$ is that the mean of mouse $weight$ can be explained by $27.5$\n\n$weight$ is the *response variable*\n\n$27.5$ is the *explanatory variable*\n\n## 3. Calculate test-statistic, exact p-value {.smaller}\n\nNonparametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nx <- 27.5 # standard from google\n\nb |>\n  ??_test(weight ~ 1, mu = ??) |>\n  gt()\n```\n:::\n\n\n. . .\n\nParametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nx <- 27.5 # standard from google\n\nb |>\n  ??_test(weight ~ 1, mu = ??) |>\n  gt()\n```\n:::\n\n\n. . .\n\nP values are well below 0.05\n\n> $\\mathcal{H}_0$ is that the mean of mouse $weight$ can be explained by $27.5$ is **NOT WELL SUPPORTED**\n\nSo $27.5 g$ not able to describe weight\n\nNot surprising since our mean mouse weight is 20.2. Don't believe everything you read on the internet.\n\n## Compare mean of two groups {.smaller}\n\n$y$ is independent of $x$\n\n$y$ is continuous\n\n$x$ is categorical with 2 groups (factor w/2 levels)\n\n**Parametric: Student's t-test**\n\n`t_test(y ~ x)` [more here](https://rpkgs.datanovia.com/rstatix/reference/t_test.html)\n\nneed to pay attention to: `var.equal` `paired`\n\n**Nonparametric: Wilcoxon signed-rank**\n\n`wilcox_test(y ~ x)` [more here](https://rpkgs.datanovia.com/rstatix/reference/wilcox_test.html)\n\nneed to pay attention to: `paired`\n\n1.  Examine and specify the variable(s)\n2.  Declare null hypothesis $\\mathcal{H}_0$\n3.  Calculate test-statistic, exact p-value\n\n## Tangent on Student's t-test\n\nThe T-Distribution, also known as Student's t-distribution, gets its name from William Sealy Gosset who first published it in English in 1908 in the scientific journal Biometrika using his pseudonym \"Student\" because his employer preferred staff to use pen names when publishing scientific papers instead of their real name, so he used the name \"Student\" to hide his identity.\n\n## Guinness Brewery in Dublin\n\n![](/img/gosset.jpg){width=\"2in\"}\n\n![](/img/inara_guinness.jpg){width=\"2in\"}\n\n## 1. Examine and specify the variable(s) {.smaller}\n\nWe will compare mouse $weight$ by $sex$.\n\n$weight$ is the *response variable*\n\n$sex$ is the *explanatory variable*\n\n$y$ \\~ $x$\n\n$weight$ \\~ $sex$\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggdensity(\n  data = b,\n  color = \"sex\",\n  x = \"weight\",\n  add = \"mean\",\n  rug = TRUE\n  )\n```\n:::\n\n\n------------------------------------------------------------------------\n\nI want the response variable on the $y$ axis and the explanatory variable on the $x$ axis.\n\nViolin plot\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggviolin(\n  data = b,\n  y = \"??\",\n  x = \"??\",\n  fill = \"??\",\n  add = \"mean_sd\"\n  )\n```\n:::\n\n\n. . .\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |> \n  group_by(??) |>\n  get_summary_stats(\n    ??,\n    type = \"common\",\n    show = c(\"mean\",\"median\",\"sd\")\n    )\n```\n:::\n\n\n## Is it normally distributed? {.smaller}\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggqqplot(\n  data = b,\n  x = \"??\",\n  color = \"??\"\n  )\n```\n:::\n\n\n. . .\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |> \n  group_by(sex) |>\n  ??_test(weight) |>\n  gt()\n```\n:::\n\n\nLooks reasonable\n\n## Equal variance?\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |> \n  ??_test(weight~sex) |>\n  gt()\n```\n:::\n\n\nOK - so we can use t-test, but variance is not equal.\n\n## 2. Declare null hypothesis $\\mathcal{H}_0$\n\n> $\\mathcal{H}_0$ is that $sex$ cannot explain $weight$\n\n## 3. Calculate test-statistic, exact p-value {.smaller}\n\nNonparametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nb |>\n  ??_test(?? ~ ??, ref.group = \"F\") |>\n  gt()\n```\n:::\n\n\n. . .\n\nParametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nx <- 27.5 # standard from google\n\nb |>\n  ??_test(weight ~ sex,\n         var.equal = ??,\n         ref.group = \"F\") |>\n  gt()\n```\n:::\n\n\n. . .\n\nP values are well below 0.05\n\n> $\\mathcal{H}_0$ is that $sex$ cannot explain $weight$ is **NOT WELL SUPPORTED**\n\n$sex$ can explain $weight$\n\n## Visualize the result {.smaller}\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# save statistical test result\nstatres <- b |>\n  t_test(weight ~ sex,\n         var.equal = F, \n         ref.group = \"F\")\n\n\nggviolin(\n  data = b,\n  y = \"weight\",\n  x = \"sex\",\n  fill = \"sex\",\n  add = \"mean_sd\"\n  ) +\n  stat_pvalue_manual(\n    ??,\n    label = \"p\",\n    y.position = 34 \n    ) +\n  ylim(10,35)\n```\n:::\n\n\n## Compare means of three or more groups {.smaller}\n\n$y$ is independent of $x$\n\n$y$ is continuous\n\n$x$ is 2 or more groups of categorical data\n\n**Parametric: ANOVA**\n\n`anova_test(y ~ group)` [more info](https://rpkgs.datanovia.com/rstatix/reference/anova_test.html)\n\n**Nonparametric: Kruskal-Wallis test**\n\n`kruskal_test(y ~ group)` [more info](https://rpkgs.datanovia.com/rstatix/reference/kruskal_test.html)\n\n1.  Examine and specify the variable(s)\n2.  Declare null hypothesis $\\mathcal{H}_0$\n3.  Calculate test-statistic, exact p-value\n\n## 1. Examine and specify the variable(s) {.smaller}\n\nWe will compare mouse $weight$ by $family$.\n\n$weight$ is the *response variable*\n\n$family$ is the *explanatory variable*\n\n$y$ \\~ $x$\n\n$weight$ \\~ $family$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# i have pre-selected some families to compare\nmyfams <- c(\"B1.5:E1.4(4) B1.5:A1.4(5)\",\n            \"F1.3:A1.2(3) F1.3:E2.2(3)\",\n            \"A1.3:D1.2(3) A1.3:H1.2(3)\",\n            \"D5.4:G2.3(4) D5.4:C4.3(4)\")\n\n# only keep the familys in myfams\nbfam <- b |>\n  filter(family %in% myfams) |>\n  droplevels() \n\n# simplify family names and make factor\nbfam$family <- gsub(pattern = \"\\\\..*\", replacement = \"\", x = bfam$family) |>\n  as.factor()\n\n\n# make B1 the reference (most similar to overall mean)\nbfam$family <- relevel(x = bfam$family, ref =\"B1\")\n```\n:::\n\n\n## Visualize the variable(s) {.smaller}\n\nI want the response variable on the $y$ axis and the explanatory variable on the $x$ axis.\n\nBoxplot\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggboxplot(\n  data = bfam,\n  y = \"??\",\n  x = \"??\",\n  fill = \"??\"\n  )\n```\n:::\n\n\n. . .\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nbfam |> \n  group_by(??) |>\n  get_summary_stats(\n    ??,\n    type = \"common\",\n    show = c(\"mean\",\"median\",\"sd\")\n    )\n```\n:::\n\n\n## Is it normally distributed? {.smaller}\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nggqqplot(\n  data = bfam,\n  x = \"weight\",\n  color = \"??\"\n  )\n```\n:::\n\n\n. . .\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nbfam |> \n  group_by(family) |>\n  ??_test(weight) |>\n  gt()\n```\n:::\n\n\nLooks reasonable\n\n## Equal variance?\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nbfam |> \n  ??_test(??~??) |>\n  gt()\n```\n:::\n\n\nOK - so we can use anova!\n\n## 2. Declare null hypothesis $\\mathcal{H}_0$\n\n> $\\mathcal{H}_0$ is that $family$ cannot explain $weight$\n\n## 3. Calculate test-statistic, exact p-value {.smaller}\n\nParametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nbfam |>\n  ??_test(weight ~ ??) |>\n  gt()\n```\n:::\n\n\n. . .\n\nNonparametric test:\n\n\n::: {.cell output-location='column-fragment'}\n\n```{.r .cell-code}\nbfam |>\n  ??_test(weight ~ family) |>\n  gt()\n```\n:::\n\n\n. . .\n\nP values are well below 0.05\n\n> $\\mathcal{H}_0$ is that $family$ cannot explain $weight$ is **NOT WELL SUPPORTED**\n\n$family$ can explain $weight$\n\n## Visualize the result {.smaller}\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# save statistical test result\nstatres <- bfam |>\n  anova_test(weight ~ sex)\n\n\nggboxplot(\n  data = bfam,\n  y = \"weight\",\n  x = \"family\",\n  fill = \"family\"\n  ) + \n  stat_anova_test()\n```\n\n::: {.cell-output-display}\n![](ex-12_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n## Multiple pairwise comparisons {.smaller}\n\nQuick aside\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n# save statistical test result\npairwise <- bfam |>\n  t_test(weight ~ family, ref.group = \"??\") \n\n\nggboxplot(bfam,\n          x = \"family\",\n          y = \"weight\",\n          fill = \"weight\",\n          ) +\n  stat_pvalue_manual(\n    pairwise,\n    label = \"p.adj\", \n    y.position = c(30, 32, 34)\n    ) +\n  ylim(10,38)\n```\n:::\n\n\nNotice that not all pairwise differences are significant, yet the ANOVA is significant.\n\n## Appropriate statistical test cheatsheet\n\n![](/img/stats_table.png)\n\n## References\n\n[Legal analogy](https://www.graphpad.com/guides/prism/latest/statistics/hypothesis_testing_and_statistical_significance.htm)\\\n\n[StatQuest: P Values, clearly explained](https://www.youtube.com/watch?v=5Z9OIYA8He8)\\\n\n[StatQuest: How to calculate p-values](https://www.youtube.com/watch?v=JQc3yx0-Q9E)\\\n\n[The Curious Tale of William Sealy Gosset](https://medium.com/value-stream-design/the-curious-tale-of-william-sealy-gosset-b3178a9f6ac8)\\\n",
    "supporting": [
      "ex-12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}